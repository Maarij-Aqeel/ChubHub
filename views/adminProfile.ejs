<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Club Hub</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="/css/adminprofile.css" />
  </head>
  <body>
    <div id="toast-container"></div>
    <div
      id="flash-data"
      data-flash="<%- JSON.stringify(flash || {}) %>"
      style="display: none"
    ></div>
    <!-- ===== Navbar ===== -->
    <div class="navbar">
      <div class="navbar-left">
        <div class="navbar-brand">
          <i class="fas fa-shield-halved"></i>
          <span>Admin Portal</span>
        </div>
        <a href="/admin/dashboard">
          <i class="fas fa-home"></i>
          <span>Dashboard</span>
        </a>
        <a href="/admin/reports">
          <i class="fas fa-chart-line"></i>
          <span>Reports</span>
        </a>
        <a href="/admin/settings">
          <i class="fas fa-cog"></i>
          <span>Profile Settings</span>
        </a>
      </div>
      <a href="/logout">
        <button class="logout-btn-nav">
          <i class="fas fa-sign-out-alt"></i>
          <span>Log Out</span>
        </button>
      </a>
    </div>

    <div class="profile-container">
      <!-- Banner & Profile Picture -->
      <div class="banner-section">
        <div class="banner"></div>
        <div class="profile-pic">
          <img
            src="<%= user.profile_data.profilePic %>"
            alt="Profile Picture"
          />
        </div>
      </div>

      <!-- Admin Details -->
      <div class="admin-details">
        <h2>
          <%= user.username %>
          <span class="admin-badge">Administrator</span>
        </h2>
        <p>
          <i class="fas fa-envelope"></i>
          <%= user.email %>
        </p>

        <!-- Stats -->
        <div class="stats">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-user-graduate"></i>
            </div>
            <h3><%= stats.students %></h3>
            <p>Students</p>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-users"></i>
            </div>
            <h3><%= stats.clubs %></h3>
            <p>Clubs</p>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-newspaper"></i>
            </div>
            <h3><%= stats.posts %></h3>
            <p>Posts</p>
          </div>
        </div>
      </div>

      <!-- Management Section -->
      <div class="management">
        <div class="section-header">
          <i class="fas fa-tasks"></i>
          <h3>Quick Management</h3>
        </div>
        <div class="manage-buttons">
          <a href="/admin/club-requests">
            <button class="warning">
              <i class="fas fa-user-clock"></i>
              <span>Pending Club Requests</span>
            </button>
          </a>
          <a href="/admin/posts">
            <button class="warning">
              <i class="fas fa-file-circle-check"></i>
              <span>Pending Posts</span>
            </button>
          </a>
          <a href="/admin/events">
            <button class="warning">
              <i class="fas fa-calendar-check"></i>
              <span>Pending Events</span>
            </button>
          </a>
        </div>
      </div>

      <!-- Recent Actions -->
      <div class="recent-actions">
        <div class="section-header">
          <i class="fas fa-history"></i>
          <h3>Recent Actions</h3>
        </div>
        <% if (recentLogs && recentLogs.length) { %>
          <% recentLogs.forEach(log => { %>
            <div class="action-card">
              <div class="action-header">
                <div class="action-type">
                  <i class="fas fa-circle-check"></i>
                  <span><%= log.action %> <%= log.targetType %> #<%= log.targetId %></span>
                </div>
                <div class="action-time">
                  <i class="far fa-clock"></i>
                  <%= new Date(log.createdAt).toLocaleString() %>
                </div>
              </div>
              <% if (log.details) { %>
                <div class="action-details"><%= log.details %></div>
              <% } %>
            </div>
          <% }); %>
        <% } else { %>
        <div class="empty-state">
          <i class="fas fa-inbox"></i>
          <h3>No Recent Actions</h3>
          <p>Your activity log will appear here.</p>
        </div>
        <% } %>
      </div>
    </div>
    <script>
      window.addEventListener("DOMContentLoaded", function () {
        const flash = JSON.parse(
          document.getElementById("flash-data").dataset.flash || "{}"
        );
        if (flash && (flash.error || flash.message)) {
          showToast(
            flash.error ? flash.error : flash.message,
            flash.error ? "error" : "success"
          );
        }
      });
      function showToast(msg, type) {
        const container = document.getElementById("toast-container");
        const toast = document.createElement("div");
        toast.className =
          "toast " + (type === "error" ? "toast-error" : "toast-success");
        toast.innerText = msg;
        container.appendChild(toast);
        setTimeout(() => {
          toast.classList.add("show");
        }, 100);
        setTimeout(() => {
          toast.classList.remove("show");
          setTimeout(() => toast.remove(), 500);
        }, 3400);
      }
    </script>
    <style>
      #toast-container {
        z-index: 9999;
        position: fixed;
        top: 32px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .toast {
        opacity: 0;
        min-width: 250px;
        margin-top: 12px;
        padding: 1em 2em;
        border-radius: 8px;
        background: #2563eb;
        color: #fff;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        font-weight: 500;
        transition: opacity 0.4s, transform 0.4s;
        transform: translateY(-25px) scale(0.95);
        transition: all 0.4s;
        pointer-events: none;
      }
      .toast.show {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      .toast-error {
        background: #e11d48;
      }
      .toast-success {
        background: #16a34a;
      }
    </style>
  </body>
</html>
